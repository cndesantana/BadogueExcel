words_td <- words_td %>%
count(sentimento, term, wt = count) %>%
ungroup() %>%
mutate(term = reorder(term,n,decreasing=TRUE)) %>%
filter(n >= 3)
p <- ggplot(words_td, aes(x = reorder(term, n), y = n, fill = sentimento)) +
geom_bar(stat="identity", fill="magenta") +
ylab("Numero de ocorrencias") +
xlab("Palavras") +
geom_text( aes (label = n ) , vjust = - 0.10, hjust = -0.8, size = 2 ) +
coord_flip()
print(p);
words_td <- getTidyWords(text);
words_td <- words_td %>%
count(sentimento, term, wt = count) %>%
ungroup() %>%
mutate(term = reorder(term,n,decreasing=TRUE)) %>%
filter(n >= 3)
p <- ggplot(words_td, aes(x = reorder(term, n), y = n, fill = sentimento)) +
geom_bar(stat="identity", fill="magenta") +
ylab("Numero de ocorrencias") +
xlab("") +
geom_text( aes (label = n ) , vjust = - 0.10, hjust = -0.8, size = 2 ) +
coord_flip()
print(p);
words_td <- getTidyWords(text);
words_td <- words_td %>%
count(sentimento, term, wt = count) %>%
ungroup() %>%
mutate(term = reorder(term,n,decreasing=TRUE)) %>%
filter(n >= 3)
p <- ggplot(words_td, aes(x = reorder(term, n), y = n, fill = sentimento)) +
geom_bar(stat="identity", fill="magenta") +
ylab("Numero de ocorrencias") +
xlab("") +
geom_text( aes (label = n ) , vjust = 0, hjust = -0.8, size = 2 ) +
coord_flip()
print(p);
words_td <- getTidyWords(text);
words_td <- words_td %>%
count(sentimento, term, wt = count) %>%
ungroup() %>%
mutate(term = reorder(term,n,decreasing=TRUE)) %>%
filter(n >= 3)
p <- ggplot(words_td, aes(x = reorder(term, n), y = n, fill = sentimento)) +
geom_bar(stat="identity", fill="magenta") +
ylab("Numero de ocorrencias") +
xlab("") +
geom_text( aes (label = n ) , vjust = 0, hjust = 0, size = 2 ) +
coord_flip()
print(p);
top20unig <- read.csv("~/palavrasrui.csv",sep=",")
colnames(top20unig)<-c(Frequency", "UniGram")
colnames(top20unig)<-c("Frequency", "UniGram")
top20unig
p <- ggplot (top20unig, aes(x = reorder(UniGram, Frequency), y= Frequency )) +
geom_bar( stat = "Identity" , fill = "magenta" ) +
geom_text( aes (label = Frequency ) , vjust = - 0.10, hjust = -0.8, size = 2 ) +
xlab( "Termos" ) +
ylab( "Frequência" ) +
theme ( axis.text.x = element_text ( angle = 45 , hjust = 1 ) ) + coord_flip()
print(p)
top20unig
length(top20unig)
length(top20unig[,1])
length(top20unig[,1])-20
(length(top20unig[,1])-20):length(top20unig[,1])
top20unig[(length(top20unig[,1])-20):length(top20unig[,1]),]
top20unig <- top20unig[(length(top20unig[,1])-20):length(top20unig[,1]),]
palavrasfilename <- "palavras_rui_pm.png"
p <- ggplot (top20unig, aes(x = reorder(UniGram, Frequency), y= Frequency )) +
geom_bar( stat = "Identity" , fill = "magenta" ) +
geom_text( aes (label = Frequency ) , vjust = - 0.10, hjust = -0.8, size = 2 ) +
xlab( "Termos" ) +
ylab( "Frequência" ) +
theme ( axis.text.x = element_text ( angle = 45 , hjust = 1 ) ) + coord_flip()
png(palavrasfilename,width=1980,height=1280,res=300)
print(p)
dev.off()
url <- "https://www.facebook.com/ACMNetoOficial/videos/1583197398412041/"
id_pagina <- "366998400031953"
data <- "2017/09/01"
load(paste(workdir,"/fb_oauth",sep=""));
data_inicio <- ymd(as.character(data)) + days(-2);
data_final <- ymd(as.character(data)) + days(2);
mypage <- getPage(id_pagina, token = fb_oauth, feed=TRUE, since= as.character(data_inicio), until=as.character(data_final))
id_post <- mypage$id[which(as.character(mypage$link)%in%url)]
post_dados <- getPost(id_post, token=fb_oauth, n= 10000)
text <- post_dados$comments$message
words_td <- getTidyWords(text);
write(words_td,"~/palavrasneto.csv",sep=",")
words_td
savehistory("~/log.R")
write(words_td,"~/palavrasneto.csv")
write(words_td,file="~/palavrasneto.csv")
words_td <- getTidyWords(text);
write(words_td,file="~/palavrasneto.csv")
words_td
write.csv(words_td,file="~/palavrasneto.csv")
write.csv(words_td,file="~/palavrasneto.csv")
palavrasfilename <- "palavras_neto_bairro.png"
top20unig <- read.csv("~/palavrasneto.csv",sep=",")
top20unig
colnames(top20unig)<-c("Frequency","Unigram")
p <- ggplot (top20unig, aes(x = reorder(UniGram, Frequency), y= Frequency )) +
geom_bar( stat = "Identity" , fill = "magenta" ) +
geom_text( aes (label = Frequency ) , vjust = - 0.10, hjust = -0.8, size = 2 ) +
xlab( "Termos" ) +
ylab( "Frequência" ) +
theme ( axis.text.x = element_text ( angle = 45 , hjust = 1 ) ) + coord_flip()
png(palavrasfilename,width=1980,height=1280,res=300)
print(p)
dev.off()
top20unig
names(top20unig)
top20unig <- top20unig[(length(top20unig[,1])-20):length(top20unig[,1]),]
top20unig
ggplot (top20unig, aes(x = reorder(UniGram, Frequency), y= Frequency )) +
geom_bar( stat = "Identity" , fill = "magenta" ) +
geom_text( aes (label = Frequency ) , vjust = - 0.10, hjust = -0.8, size = 2 ) +
xlab( "Termos" ) +
ylab( "Frequência" ) +
theme ( axis.text.x = element_text ( angle = 45 , hjust = 1 ) ) + coord_flip()
names(top20unig)
ggplot (top20unig, aes(x = reorder(UniGram, Frequency), y= Frequency )) +
geom_bar( stat = "Identity" , fill = "magenta" ) +
geom_text( aes (label = Frequency ) , vjust = - 0.10, hjust = -0.8, size = 2 ) +
xlab( "Termos" ) +
ylab( "Frequência" ) +
theme ( axis.text.x = element_text ( angle = 45 , hjust = 1 ) ) + coord_flip()
ggplot (top20unig, aes(x = reorder(UniGram, Frequency), y= Frequency ))
top20unig$Unigram
ggplot (top20unig, aes(x = reorder(top20unig$UniGram, Frequency), y= Frequency ))
myx <- top20unig$UniGram
myy <- top20unig$Frequency
myy
myx
myx <- as.character(top20unig$UniGram)
myx
top20unig$Unigram
unlist(top20unig$Unigram)
as.character(unlist(top20unig$Unigram))
myx <- as.character(unlist(top20unig$Unigram))
ggplot (aes(x = reorder(myx, myy), y= myy )) +
geom_bar( stat = "Identity" , fill = "magenta" ) +
geom_text( aes (label = myy ) , vjust = - 0.10, hjust = -0.8, size = 2 ) +
xlab( "Termos" ) +
ylab( "Frequência" ) +
theme ( axis.text.x = element_text ( angle = 45 , hjust = 1 ) ) + coord_flip()
top20unig <- read.csv("~/palavrasneto.csv",sep=",")
class(top20unig)
top20unig
names(top20unig)
colnames(top20unig)<-c("Frequency","Unigram")
top20unig
names(top20unig)
colnames(top20unig)<-c("Frequency","UniGram")
ggplot (top20unig, aes(x = reorder(UniGram, Frequency), y= Frequency )) +
geom_bar( stat = "Identity" , fill = "magenta" ) +
geom_text( aes (label = Frequency ) , vjust = - 0.10, hjust = -0.8, size = 2 ) +
xlab( "Termos" ) +
ylab( "Frequência" ) +
theme ( axis.text.x = element_text ( angle = 45 , hjust = 1 ) ) + coord_flip()
top20unig <- top20unig[(length(top20unig[,1])-20):length(top20unig[,1]),]
ggplot (top20unig, aes(x = reorder(UniGram, Frequency), y= Frequency )) +
geom_bar( stat = "Identity" , fill = "magenta" ) +
geom_text( aes (label = Frequency ) , vjust = - 0.10, hjust = -0.8, size = 2 ) +
xlab( "Termos" ) +
ylab( "Frequência" ) +
theme ( axis.text.x = element_text ( angle = 45 , hjust = 1 ) ) + coord_flip()
p <- ggplot (top20unig, aes(x = reorder(UniGram, Frequency), y= Frequency )) +
geom_bar( stat = "Identity" , fill = "magenta" ) +
geom_text( aes (label = Frequency ) , vjust = - 0.10, hjust = -0.8, size = 2 ) +
xlab( "Termos" ) +
ylab( "Frequência" ) +
theme ( axis.text.x = element_text ( angle = 45 , hjust = 1 ) ) + coord_flip()
png(palavrasfilename,width=1980,height=1280,res=300)
print(p)
dev.off()
library(shiny)
library(plotrix)
library(tm)
library(stringr)
library(dplyr)
fa <- function(x) iconv(x, to = "ASCII//TRANSLIT")
getMatrizDeOcorrencias <- function(text){
text <- stringi::stri_trans_tolower(text)
temp <- fa(text)
# Lowercase
# Shrink down to just one white space
temp <- stringr::str_replace_all(temp,"[\\s]+", " ")
temp=str_replace_all(temp,"[^[:graph:]]", " ")
# Split it
any(grepl("I_WAS_NOT_ASCII", iconv(temp, "latin1", "ASCII", sub="I_WAS_NOT_ASCII")))
temp <- stringi::stri_trans_general(temp, "latin-ascii")
temp <- removePunctuation(temp)
temp <- unlist(stringr::str_split(temp, " "))
# Get rid of trailing "" if necessary
indexes <- which(temp == "")
if(length(indexes) > 0){
temp <- temp[-indexes]
}
docs <- Corpus(VectorSource(temp))
docs <- tm_map(docs, removeNumbers)
# Remove english common stopwords
docs <- tm_map(docs, removeWords, stopwords("portuguese"))
# Remove your own stop word
docs <- tm_map(docs, removeWords, c("blabla1", "blabla2","que","ser","pelo","tem","o","lhe","por","pra","de","da","do","essa","esse","isso","aquele","aquilo","desse","disso","daquilo","uma","um","NA"))
#  Remove punctuations
docs <- tm_map(docs, stripWhitespace)
#
dtm <- TermDocumentMatrix(docs)
m <- as.matrix(dtm)
v <- sort(rowSums(m),decreasing=TRUE)
d <- data.frame(word = names(v),freq=v)
return(d)
}
plotPalavras <- function(text, sentimento){
mycol <- switch(sentimento,
geral = "gray50",
negativo = "red",
positivo = "green",
neutro = "blue")
d <- getMatrizDeOcorrencias(text)
nwords <- ifelse(length(as.character(d[,1])) > 10, 10, length(as.character(d[,1])))
d <- d[1:nwords,]
p <- ggplot(d, aes(x = reorder(word, freq), y = freq)) +
geom_bar( stat = "Identity" , fill = mycol) +
geom_text( aes (label = freq ) , vjust = - 0.10, hjust = -0.8, size = 2 ) +
xlab(NULL) +
ylab("Número de Ocorrências") +
coord_flip()
print(p)
}
getIndiceDeSentimento <- function(polaridade){
sentimentos <- toupper(polaridade)
allsentimentos <- c("NEUTRO","NEGATIVO","POSITIVO");
mn <- length(which(sentimentos==allsentimentos[1]));#Neutro
mr <- length(which(sentimentos==allsentimentos[2]));#Negativo
mp <- length(which(sentimentos==allsentimentos[3]));#Positivo
mt <- mr + mn + mp;#Total
indicesentimento <- ifelse(mn == mt, 0, as.numeric((mp-mr)/(mt-mn)))
return(indicesentimento)
}
library(readxl)
file <- read_xlsx("~/comentariosrui1.xlsx")
names(file)
file <- read_xlsx("~/comentariosrui1.xlsx")
allpolaridade <- toupper(file$Polaridade)
isent <- getIndiceDeSentimento(allpolaridade);
isent
plot(-10:10,axes=FALSE,xlab="",ylab="",type="n")
gradient.rect(1,-10,3,10,reds=c(1,0), greens=c(seq(0,1,length=10),seq(1,0,length=10)),blues=c(0,1),gradient="y")
text(x = 3, y=signif(isent,2), labels = paste(intToUtf8(9664),signif(isent,2)),pos = 4)
text(x = 0, y=10,  labels = 1,pos = 4)
text(x = 0, y=-10, labels = -1,pos = 4)
plot(-10:10,axes=FALSE,xlab="",ylab="",type="n")
gradient.rect(1,-10,3,10,reds=c(1,0), greens=c(seq(0,1,length=10),seq(1,0,length=10)),blues=c(0,1),gradient="y")
text(x = 0, y=10,  labels = 1,pos = 4)
text(x = 0, y=-10, labels = -1,pos = 4)
text(x = 3, y=10*signif(isent,2), labels = paste(intToUtf8(9664),signif(isent,2)),pos = 4)
shiny::runApp()
url <- "https://www.facebook.com/ACMNetoOficial/videos/1563294350402346/"
id_pagina <- "366998400031953"
data <- "2017/08/09"
workdir
workdir <- "/home/cdesantana/DataSCOUT/Objectiva/BadogueExcel"
badwords <- c("scontent.xx.fbcdn.net","https","oh","oe","pra"," v ","como","para","de","do","da","das","dos","isso","esse","nisso","nesse","aquele","nesses","aqueles","aquela","aquelas","que","q","é","sr","governador","rui","costa","senhor")
library(stringr)
library(quanteda)
library(readtext)
library(ggplot2)
library(tidyr)
library(shinydashboard)
library(shiny)
library(shinyFiles)
library(devtools)
library(Rfacebook)
library(lubridate)
library(dplyr)
library(stylo)
library(tidytext)
library(tm)
library(wordcloud)
library(xlsx)
library(gdata)
library(readxl)
library(htmlwidgets)
library(wordcloud)
load(paste(workdir,"/fb_oauth",sep=""));
data_inicio <- ymd(as.character(data)) + days(-2);
data_final <- ymd(as.character(data)) + days(2);
mypage <- getPage(id_pagina, token = fb_oauth, feed=TRUE, since= as.character(data_inicio), until=as.character(data_final))
id_post <- mypage$id[which(as.character(mypage$link)%in%url)]
post_dados <- getPost(id_post, token=fb_oauth, n= 10000)
names(post_dados)
post_dados$likes
mypage
id_post
post_reactions <- getReactions(id_post, token=fb_oauth)
post_reactions
counts <- as.numeric(post_reactions[-1,])
counts
counts <- as.numeric(post_reactions[,-1])
counts
mynames <- as.character(names(post_reactions[,-1]))
mynames
percent <- signif(100*(counts/sum(counts)),2)
percent
percent <- signif(100*(counts/sum(counts)),1)
percent
library(plotly)
plot_ly(labels = ~mynames, values = ~percent) %>%
add_pie(hole = 0.6)
dev.off()
p <- plot_ly(labels = ~mynames, values = ~percent) %>%
add_pie(hole = 0.6)
plotly_POST(p, filename="donut")
plot_ly(labels = ~mynames, values = ~percent) %>%
add_pie(hole = 0.6)
p <- plot_ly(labels = ~mynames, values = ~percent) %>%
add_pie(hole = 0.6)
chart-link <- plotly_POST(p, filename="donut")
ggplot() +
geom_rect(aes(fill=mynames, ymax=max(percent), ymin=0, xmax=4, xmin=3)) +
coord_polar(theta="y") +
xlim(c(0, 4)) +
labs(title="Basic ring plot")
ggplot() +
geom_rect(aes(fill=mynames, ymax=max(percent), ymin=0, xmax=100, xmin=0)) +
coord_polar(theta="y") +
xlim(c(0, 100)) +
labs(title="Basic ring plot")
ymax <- 100
ymin = c(0, head(ymax, n=-1))
ymin
myymax <- 100
myymin = c(0, head(myymax, n=-1))
ggplot() +
geom_rect(aes(fill=mynames, ymax=myymax, ymin=myymin, xmax=4, xmin=3)) +
coord_polar(theta="y") +
xlim(c(0, 4)) +
labs(title="Basic ring plot")
mynames
cumsum(percent)
myymax <- cumsum(percent)
myymin = c(0, head(myymax, n=-1))
ggplot() +
geom_rect(aes(fill=mynames, ymax=myymax, ymin=myymin, xmax=4, xmin=3)) +
coord_polar(theta="y") +
xlim(c(0, 4)) +
labs(title="Basic ring plot")
ggplot() +
geom_rect(aes(fill=mynames, ymax=myymax, ymin=myymin, xmax=10, xmin=3)) +
coord_polar(theta="y") +
xlim(c(0, 10)) +
labs(title="Reações")
ggplot() +
geom_rect(aes(fill=mynames, ymax=myymax, ymin=myymin, xmax=4, xmin=3)) +
coord_polar(theta="y") +
xlim(c(0, 4)) +
labs(title="Reações")
ggplot() +
geom_rect(aes(fill=mynames, ymax=myymax, ymin=myymin, xmax=4, xmin=3)) +
coord_polar(theta="y") +
xlim(c(0, 4)) +
labs(title="")
ggplot() +
geom_rect(aes(fill=mynames, ymax=myymax, ymin=myymin, xmax=4, xmin=3)) +
coord_polar(theta="y") +
xlim(c(0, 4)) +
theme_bw() +
theme(panel.grid=element_blank()) +
theme(axis.text=element_blank()) +
theme(axis.ticks=element_blank()) +
labs(title="")
ggplot() +
geom_rect(aes(fill=mynames, ymax=myymax, ymin=myymin, xmax=4, xmin=3)) +
coord_polar(theta="y") +
xlim(c(0, 100)) +
theme_bw() +
theme(panel.grid=element_blank()) +
theme(axis.text=element_blank()) +
theme(axis.ticks=element_blank()) +
labs(title="")
ggplot() +
geom_rect(aes(fill=mynames, ymax=myymax, ymin=myymin, xmax=100, xmin=3)) +
coord_polar(theta="y") +
xlim(c(0, 100)) +
theme_bw() +
theme(panel.grid=element_blank()) +
theme(axis.text=element_blank()) +
theme(axis.ticks=element_blank()) +
labs(title="")
ggplot() +
geom_rect(aes(fill=mynames, ymax=myymax, ymin=myymin, xmax=100, xmin=80)) +
coord_polar(theta="y") +
xlim(c(0, 100)) +
theme_bw() +
theme(panel.grid=element_blank()) +
theme(axis.text=element_blank()) +
theme(axis.ticks=element_blank()) +
labs(title="")
ggplot() +
geom_rect(aes(fill=mynames, ymax=myymax, ymin=myymin, xmax=100, xmin=80)) +
coord_polar(theta="y") +
xlim(c(0, 100)) +
theme_bw() +
theme(panel.grid=element_blank()) +
theme(axis.text=element_blank()) +
theme(axis.ticks=element_blank()) +
labs(title="") +
annotate("text", x = 0, y = 0, size = 15, label = "Reações")
ggplot() +
geom_rect(aes(fill=mynames, ymax=myymax, ymin=myymin, xmax=100, xmin=80)) +
coord_polar(theta="y") +
xlim(c(0, 100)) +
theme_bw() +
theme(panel.grid=element_blank()) +
theme(axis.text=element_blank()) +
theme(axis.ticks=element_blank()) +
labs(title="") +
annotate("text", x = 0, y = 0, size = 15, label = "Reactions")
ggplot() +
geom_rect(aes(fill=mynames, ymax=myymax, ymin=myymin, xmax=100, xmin=80)) +
coord_polar(theta="y") +
xlim(c(0, 100)) +
theme_bw() +
theme(panel.grid=element_blank()) +
theme(axis.text=element_blank()) +
theme(axis.ticks=element_blank()) +
labs(title="") +
annotate("text", x = 0, y = 0, size = 15, label = "Reactions")
ggplot() +
geom_rect(aes(fill=mynames, ymax=myymax, ymin=myymin, xmax=100, xmin=80)) +
coord_polar(theta="y") +
xlim(c(0, 100)) +
theme_bw() +
theme(panel.grid=element_blank()) +
theme(axis.text=element_blank()) +
theme(axis.ticks=element_blank()) +
labs(title="")
reactions <- mynames;
ggplot() +
geom_rect(aes(fill=mynames, ymax=myymax, ymin=myymin, xmax=100, xmin=80)) +
coord_polar(theta="y") +
xlim(c(0, 100)) +
theme_bw() +
theme(panel.grid=element_blank()) +
theme(axis.text=element_blank()) +
theme(axis.ticks=element_blank()) +
labs(title="")
ggplot() +
geom_rect(aes(fill=reactions, ymax=myymax, ymin=myymin, xmax=100, xmin=80)) +
coord_polar(theta="y") +
xlim(c(0, 100)) +
theme_bw() +
theme(panel.grid=element_blank()) +
theme(axis.text=element_blank()) +
theme(axis.ticks=element_blank()) +
labs(title="")
ggplot() +
geom_rect(aes(fill=reactions, ymax=myymax, ymin=myymin, xmax=100, xmin=80)) +
coord_polar(theta="y") +
xlim(c(0, 100)) +
geom_label_repel(aes(label = paste(percent,"%"), x = 100, y = (ymin + ymax)/2),inherit.aes = F, show.legend = F, size = 5)+
theme_bw() +
theme(panel.grid=element_blank()) +
theme(axis.text=element_blank()) +
theme(axis.ticks=element_blank()) +
labs(title="")
library(ggrepel)
install.packages("ggrepel")
library(ggrepel)
ggplot() +
geom_rect(aes(fill=reactions, ymax=myymax, ymin=myymin, xmax=100, xmin=80)) +
coord_polar(theta="y") +
xlim(c(0, 100)) +
geom_label_repel(aes(label = paste(percent,"%"), x = 100, y = (ymin + ymax)/2),inherit.aes = F, show.legend = F, size = 5)+
theme_bw() +
theme(panel.grid=element_blank()) +
theme(axis.text=element_blank()) +
theme(axis.ticks=element_blank()) +
labs(title="")
ggplot() +
geom_rect(aes(fill=reactions, ymax=myymax, ymin=myymin, xmax=100, xmin=80)) +
coord_polar(theta="y") +
xlim(c(0, 100)) +
geom_label_repel(aes(label = paste(percent,"%"), x = 100, y = (myymin + myymax)/2),inherit.aes = F, show.legend = F, size = 5)+
theme_bw() +
theme(panel.grid=element_blank()) +
theme(axis.text=element_blank()) +
theme(axis.ticks=element_blank()) +
labs(title="")
counts <- as.numeric(post_reactions[,-1])
reactions <- as.character(names(post_reactions[,-1]))
percent <- signif(100*(counts/sum(counts)),1)
ggplot() +
geom_bar(stat="identity", aes(x=reactions, y = counts)) +
xlab("Reações") +
ylab("Número de Ocorrências") +
coord_flip()
reactions
counts <- as.numeric(post_reactions[,-1])
reactions <- c("Likes","Loves","Haha","Wow","Sad", "Angry")
percent <- signif(100*(counts/sum(counts)),1)
ggplot() +
geom_bar(stat="identity", aes(x=reactions, y = counts)) +
xlab("Reações") +
ylab("Número de Ocorrências") +
coord_flip()
runApp()
